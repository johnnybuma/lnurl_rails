<!-- app/views/block_histories/_chart.html.erb -->

<div id="difficulty-chainwork-chart" style="width:100%; height:400px;"></div>

<script>
    document.addEventListener('turbo:frame-load', function (event) {
        if (event.target.id === 'block_chart') {
            var rawData = <%= @chart_data.to_json.html_safe %>;

            if (rawData && rawData.length > 0) {
                var difficultyData = rawData.map(function(item) {
                    return [item.block_number, parseFloat(item.difficulty)];
                });
                var chainworkData = rawData.map(function(item) {
                    return [item.block_number, parseFloat(item.chainwork)];
                });

                // Debug: Log the difficultyData to inspect its structure
                console.log(difficultyData);

                Highcharts.chart('difficulty-chainwork-chart', {
                    chart: {
                        type: 'line'
                    },
                    title: {
                        text: 'Difficulty vs Chainwork'
                    },
                    xAxis: {
                        title: {
                            text: 'Block Number'
                        }
                    },
                    yAxis: [{
                        title: {
                            text: 'Difficulty'
                        }
                    }, {
                        title: {
                            text: 'Chainwork'
                        },
                        opposite: true
                    }],
                    series: [{
                        name: 'Difficulty',
                        data: difficultyData
                    }, {
                        name: 'Chainwork',
                        yAxis: 1,
                        data: chainworkData
                    }]
                });
            } else {
                console.error('No data available for chart.');
            }
        }
    });
</script>

