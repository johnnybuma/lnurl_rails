<!-- app/views/block_histories/_chart.html.erb -->

<div id="difficulty-chainwork-chart" style="width:100%; height:400px;"></div>
<script>
    document.addEventListener('turbo:frame-load', function (event) {
        if (event.target.id === 'block_chart') {
            var chartData = <%= @chart_data.to_json.html_safe %>;
            if (chartData && chartData.length > 0) {
                var difficultyData = chartData.map(function(item) { return [item[0], item[1]]; });
                var chainworkData = chartData.map(function(item) { return [item[0], item[2]]; });

                Highcharts.chart('difficulty-chainwork-chart', {
                    chart: {
                        zoomType: 'x'
                    },
                    title: {
                        text: 'Difficulty vs Chainwork'
                    },
                    xAxis: {
                        type: 'block_number',
                        title: {
                            text: 'Block Number'
                        }
                    },
                    yAxis: [{
                        title: {
                            text: 'Difficulty'
                        }
                    }, {
                        title: {
                            text: 'Chainwork'
                        },
                        opposite: true
                    }],
                    plotOptions: {
                        line: {
                            marker: {
                                enabled: false
                            }
                        }
                    },
                    series: [{
                        name: 'Difficulty',
                        data: difficultyData
                    }, {
                        name: 'Chainwork',
                        data: chainworkData,
                        yAxis: 1
                    }]
                });
            } else {
                console.error('No data available for chart.');
            }
        }
    });
</script>
